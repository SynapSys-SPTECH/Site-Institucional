<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/Icon-SynapSysBranco.svg" type="image/x-icon" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="../Componentes/MenuLateral/MenuLateral.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/brands.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

    <!-- Plugin de Máscara -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

    <script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>

    <!-- Config menu suspenso -->
    <link rel="stylesheet" href="../Componentes/MenuSuspenso/submenu.css">
    <script src="https://kit.fontawesome.com/80ec270284.js" crossorigin="anonymous"></script>
    <script src="../crudPropriedade.js"></script>

    <!-- Validação de Sessão -->
    <script src="../Javascript/sessao.js"></script>

    <!-- Sweet Alerts 2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>SynapSys</title>
</head>

<script>
    window.onload = function () {
        validarSessao(),
            buscarPropriedade(),
            verificarPossuiEmpresa()
    } 
</script>

<body>
    <div class="container">
        <!-- <script src="../Componentes/MenuLateral/MenuLateral.js"></script> -->

        <div class="menu_lateral">
            <h3>Empresa</h3>

            <ul>
                <li onclick="window.location.href='../Dashboard/dashboard.html'">
                    <img src="../images/chart-svgrepo-com.svg" alt="">
                    <a>Dashboard</a>
                </li>
                <li onclick="window.location.href='../Empresas/empresas.html'">
                    <img src="../images/company-svgrepo-com.svg" alt="">
                    <a>Empresas</a>
                </li>
                <li onclick="window.location.href='../Propriedades/propriedades.html'" id="tela_ativa">
                    <img src="../images/brazil-svgrepo-com.svg" alt="">
                    <a>Propriedades</a>
                </li>
            </ul>
        </div>

        <section id="propriedades">
            <div class="adicionar_propriedade" id="add_propriedade" style="display: none;">
                <h1>Cadastrar Propriedade</h1>
                <div class="inputs_cadastrar_propriedade">
                    <div>
                        <label for="input_add_logradouro">Insira o Logradouro:</label>
                        <input type="text" id="input_add_logradouro" placeholder="ex: Rua Haddock Lobo, 595" />
                    </div>

                    <div>
                        <label for="input_add_cep">Insira o CEP</label>
                        <input type="text" id="input_add_cep" placeholder="Somente números" />
                    </div>
                    <div>
                        <label for="input_add_tamanho">Insira o Tamanho em M²</label>
                        <input type="number" id="input_add_tamanho" placeholder="Tamanho da Propriedade em M²" />
                    </div>
                    <div>
                        <label for="input_add_cidade">Insira a Cidade</label>
                        <input type="text" id="input_add_cidade" placeholder="ex: São Paulo" />
                    </div>
                    <div>
                        <label for="input_add_uf">Insira a Unidade Federativa</label>
                        <input list="suggestions" type="text" id="input_add_uf" placeholder="ex: SP" maxlength="2" />
                        <datalist id="suggestions">
                            <option value="AC">
                            <option value="AL">
                            <option value="AP">
                            <option value="AM">
                            <option value="BA">
                            <option value="CE">
                            <option value="DF">
                            <option value="ES">
                            <option value="GO">
                            <option value="MA">
                            <option value="MT">
                            <option value="MS">
                            <option value="MG">
                            <option value="PA">
                            <option value="PB">
                            <option value="PR">
                            <option value="PE">
                            <option value="PI">
                            <option value="RJ">
                            <option value="RN">
                            <option value="RS">
                            <option value="RO">
                            <option value="RR">
                            <option value="SC">
                            <option value="SP">
                            <option value="SE">
                            <option value="TO">
                        </datalist>
                    </div>
                    <div>
                        <label for="select_empresa">Escolha a Empresa a Associar a Propriedade.</label>
                        <select name="select_empresa" id="select_empresa" class="select_empresa">
                            <option value="#">Empresa 1</option>
                        </select>
                    </div>

                </div>
                <div>
                    <button class="drawer_button" id="cadastrarBtn">Cadastrar</button>
                    <button class="drawer_button_sec" onclick="toggleDrawerCadastro()">Fechar</button>
                </div>
            </div>
            <nav class="navbar">
                <div>
                    <div class="textNavbar">
                        <label for="id_propriedade">Escolha a Empresa:</label>
                    </div>

                    <select class="selectNavbar" name="Propriedade" id="select_empresa1">Escolha a Empresas

                    </select>
                </div>


                <div class="nav-profile" onclick="toggleMenuSuspenso()">
                    <div class="user-profile-button" id="user_profile-image">
                        <i class="fa-solid fa-user icon-modify"></i>

                    </div>

                    <div class="sub-menu-wrap" id="subMenu">
                        <div class="sub-menu">
                            <div class="user-info">
                                <i class="fa-solid fa-user icon-modify"></i>
                                <h2 class="user-name" id="username">Usuário</h2>
                            </div>

                            <a href="../Conta/conta.html" class="submenu-option">
                                <i class="fa-solid fa-gear icon-modify"></i>
                                <p>Conta</p>
                                <span> > </span>
                            </a>

                            <a href="../index.html" onclick="limparSessao()" class="submenu-option">
                                <i class="fa-solid fa-door-open icon-modify"></i>
                                <p>Sair</p>
                                <span> > </span>
                            </a>



                        </div>
                    </div>


            </nav>
            <div id="listagem_propriedades" style="display: flex;">

                <div class="container_listagem">
                    <div class="list_actions">
                        <h1 id="addRow">Listagem das Propriedades</h1>
                        <button class="list_button" onclick="toggleDrawerCadastro()">Cadastrar Propriedade</button>
                    </div>
                    <section class="campos">
                        <table id="tabela_propriedades" class="display" width="70vw" max-height="50vh"
                            margin-top="400px">
                            <thead>
                                <tr>
                                    <th>Empresa Associada</th>
                                    <th>Cidade</th>
                                    <th>CEP</th>
                                    <th>Logradouro</th>
                                    <th>CNPJ</th>
                                    <th>Tamanho</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                        </table>
                    </section>


                </div>
            </div>

            <div id="editar_propriedade" style="display: none;">
                <h1>Editar Propriedade</h1>
                <div class="inputs_cadastrar_propriedade">
                    <div class="div_checkbox-status">
                        <input type="checkbox" name="" id="ckbox_status_propriedade">
                        <label for="ckbox_status_propriedade">Ativar Propriedade</label>
                    </div>
                    <div>
                        <label for="input_logradouro">Altere o Logradouro:</label>
                        <input type="text" id="input_edit_logradouro" placeholder="ex: Rua Haddock Lobo, 595" />
                    </div>
                    <div>
                        <label for="input_cep">Altere o CEP</label>
                        <input type="text" id="input_edit_cep" placeholder="Somente números" />
                    </div>
                    <div>
                        <label for="input_tamanho">Altere o Tamanho em M²</label>
                        <input type="number" id="input_edit_tamanho" placeholder="Tamanho em M²" />
                    </div>
                    <div>
                        <label for="input_cidade">Altere a Cidade</label>
                        <input type="text" id="input_edit_cidade" placeholder="ex: São Paulo" />
                    </div>
                    <div>
                        <label for="input_uf">Altere a Unidade Federativa</label>
                        <input list="suggestions" type="text" id="input_edit_uf" placeholder="ex: SP" maxlength="2" />
                        <datalist id="suggestions">
                            <option value="AC">
                            <option value="AL">
                            <option value="AP">
                            <option value="AM">
                            <option value="BA">
                            <option value="CE">
                            <option value="DF">
                            <option value="ES">
                            <option value="GO">
                            <option value="MA">
                            <option value="MT">
                            <option value="MS">
                            <option value="MG">
                            <option value="PA">
                            <option value="PB">
                            <option value="PR">
                            <option value="PE">
                            <option value="PI">
                            <option value="RJ">
                            <option value="RN">
                            <option value="RS">
                            <option value="RO">
                            <option value="RR">
                            <option value="SC">
                            <option value="SP">
                            <option value="SE">
                            <option value="TO">
                        </datalist>
                    </div>


                </div>
                <div>
                    <button class="drawer_button" id="editarBtn">Editar</button>
                    <button class="drawer_button_sec" id="cadastrarBtn" onclick="toggleDrawerEdit()">Fechar</button>
                </div>
            </div>

        </section>
    </div>



    <!-- ALERTS PARA A PÁGINA -->

    <script src="../Componentes/Alerts/possuiEmpresa.js"></script>





</body>



</html>

<script>
    let subMenu = document.getElementById("subMenu");

    function toggleMenuSuspenso() {
        subMenu.classList.toggle("open-menu");
    };

    var usernameValue = sessionStorage.NOME_USUARIO;
    document.getElementById('username').textContent = usernameValue;
</script>

<script>
    console.log(window.location.href)

    let counter = 1;

    function adicionarNovaPropriedadeTabela() {
        const table = $('#tabela_propriedades').DataTable();
        table.row
            .add([
                localStorage.nomeFantasia,
                localStorage.cidade,
                localStorage.cep,
                localStorage.logradouro,
                localStorage.cnpj,
                localStorage.tamanho + "m²",
                "Ativo",
                `<button onclick="toggleDrawerEdit(this)" class="edit_btn">Editar</button>`
            ])
            .draw(false);

        counter++;
    }



    $(document).ready(function () {
        $('#tabela_propriedades').DataTable({
            language: {
                lengthMenu: "Mostrar _MENU_ propriedades por página",
                zeroRecords: "Nenhuma propriedade encontrada, cadastre uma nova propriedade.",
                info: "Mostrando _START_ até _END_ de _TOTAL_ itens",
                infoEmpty: "Mostrando 0 até 0 de 0 propriedades",
                infoFiltered: "(filtrado de _MAX_ propriedades no total)",
                search: "Buscar:",
                paginate: {
                    first: "Primeiro",
                    last: "Último",
                    next: "Próximo",
                    previous: "Anterior"
                }
            },
        });

        // document.querySelector('#addRow').addEventListener('click', adicionarNovaEmpresaTabela);
    });

    function toggleDrawerEdit(button) {

        alert("Editar empresa: " + button.closest('tr').cells[0].textContent);
    }

</script>

<script>

    function toggleDrawerCadastro() {
        const div = document.getElementById("add_propriedade");
        if (div.style.display === "none") {
            div.style.display = "flex";
        } else {
            div.style.display = "none";
        }
    }

    function toggleDrawerEdit() {
        const divEdit = document.getElementById("editar_propriedade");
        if (divEdit.style.display === "none") {
            divEdit.style.display = "flex";
        } else {
            divEdit.style.display = "none";
        }
    }


    function toggleMenu() {
        const menu = document.getElementById("menu");
        menu.classList.toggle("show-menu");
    }




    function apareceInfos(id) {
        document.getElementById(id).style.display = "flex";
        document.getElementById(id).style.opacity = 1;
    }

    function someInfos(id) {
        document.getElementById(id).style.display = "none";
        document.getElementById(id).style.opacity = 0;
    }

</script>

<script type="module">
    import { cadastrar } from '../crudPropriedade.js';
    import { buscarPropriedade } from '../crudPropriedade.js';


    buscarPropriedade()
    document.getElementById('cadastrarBtn').addEventListener('click', cadastrar);
</script>

<script>

    $(document).ready(function () {
        $('#input_edit_cep').mask('00000-000');
        $('#input_add_cep').mask('00000-000');
    });

</script>