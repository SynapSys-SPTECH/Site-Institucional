<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Document</title>
  </head>
  <body>
    <div class="propriedade">
      <h1>CADASTRO DE PROPRIEDADE</h1>

      Logradouro:<br />
      <input type="text" id="input_logradouro" />
      <br /><br />
      CEP:<br />
      <input type="text" id="input_cep" placeholder="somente números" />

      <br /><br />
      Tamanho (m² ou hectare):<br />
      <input type="text" id="input_tamanho" />
      <br /><br />

      Cidade:<br />
      <input type="text" id="input_cidade" />

      <br /><br />
      UF:<br />
      <input type="text" id="input_uf" placeholder="ex: SP" />
      <br /><br />
      <button id="cadastrar" onclick="cadastrar()">Cadastrar</button>



     <button id="listar" onclick="listar()">listar</button>

     <button id="deletar" onclick="deletar()">Deletar</button>

     <button id="atualizar" onclick="atualizar()">atualizar</button>

     

    </div>
  </body>
</html>

<script>
  function cadastrar() {
    var logradouro = input_logradouro.value;
    var tamanho = input_tamanho.value;
    var cep = input_cep.value;
    var cidade = input_cidade.value;
    var uf = input_uf.value;


    console.log(logradouro)
    console.log(cep)
    console.log(uf)
    console.log(cidade)
    console.log(tamanho)

    if (
      logradouro == "" ||
      cep == "" ||
      tamanho == "" ||
      cidade == "" ||
      uf == ""
    ) {
      alert("Todos os campos devem ser preenchidos");
    } else {
      if (cep.length != 8) {
        alert("Erro no CEP");
        return;
      }

      if (uf.length != 2) {
        alert("Erro no UF");
        return;
      }
    }

    // Enviando o valor da nova input
    fetch("/propriedades/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        logradouroServer: logradouro,
        cepServer: cep,
        tamanhoServer: tamanho,
        cidadeServer: cidade,
        ufServer: uf,

    
      }),
    })
    

      .then(function (resposta) {
        console.log("resposta: ", resposta);
        console.log(logradouroServer)
        setTimeout(() => {
          window.location = "./index.html";
        }, "1000");

        finalizarAguardar();
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

    return false;
  }

  function listar() {
    fetch("/propriedades/listar", {
      method: "GET",
      headers: {
      "Content-Type": "application/json",
    },
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Erro na requisição: ' + response.status);
    }
    return response.json()
  })
  .then(propriedades => {
    console.log(propriedades);  
  })
  .catch(error => {
    console.error('Erro:', error);
  });
}



function deletar(idPropriedade) {
  console.log("Criar função de apagar post escolhido - ID " + idPropriedade);
  fetch(`/propriedades/deletar`, {
    method: "DELETE",
    headers: {
      "Content-Type": "application/json"
    }
  }).then(function (resposta) {

    if (resposta.ok) {
      window.alert("Propriedade Deletada Com sucesso!");
      window.location = "../index.html"
    } else if (resposta.status == 404) {
      window.alert("Deu 404!");
    } else {
      throw ("Houve um erro ao tentar realizar a exclusão da conta: " + resposta.status);
    }
  }).catch(function (resposta) {
    console.log(`#ERRO: ${resposta}`);
  });
}

function atualizar() {
  var logradouro = input_logradouro.value;
    var tamanho = input_tamanho.value;
    var cep = input_cep.value;
    var cidade = input_cidade.value;
    var uf = input_uf.value;


    if (cep.length != 8 && cep.length !=0) {
        alert("Erro no CEP");
        return;
      }

      if (uf.length != 2 && cep.length !=0) {
        alert("Erro no UF");
        return;
      }
  


  fetch(`/propriedades/editar/${sessionStorage.getItem("ID_PROPRIEDADE")}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      logradouroServer: logradouro,
        cepServer: cep,
        tamanhoServer: tamanho,
        cidadeServer: cidade,
        ufServer: uf,
    })
  }).then(function (resposta) {

    if (resposta.ok) {
        window.location = "../index.html"
    } else if (resposta.status == 404) {
      window.alert("Deu 404!");
    } else {
      throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
    }
  }).catch(function (resposta) {
    console.log(`#ERRO: ${resposta}`);
  });
}

  


</script>
