<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/Icon-SynapSysBranco.svg" type="image/x-icon" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="../Componentes/MenuLateral/MenuLateral.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/brands.min.css">

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <!-- Plugin de Máscara -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

    <!-- Config para menu suspenso -->
    <script src="https://kit.fontawesome.com/80ec270284.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../Componentes/MenuSuspenso/submenu.css">

    <!-- Importando o Data Tables aqui!! -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.css">

    <!-- Validação de Sessão -->
    <script src="../Javascript/sessao.js"></script>
    
    <script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
    <script type="module" src="../empresaFetch.js"></script>
    <title>Empresas</title>

</head>

<script>
    window.onload = validarSessao()
</script>

<body>

    <!-- <script src="../Componentes/MenuLateral/MenuLateral.js"></script> -->
    <div class="menu_lateral">
        <h3>Empresa</h3>

        <ul>
            <li onclick="window.location.href='../Dashboard/dashboard.html'">
                <img src="../images/chart-svgrepo-com.svg" alt="">
                <a>Dashboard</a>
            </li>
            <li onclick="window.location.href='../Empresas/empresas.html'" id="tela_ativa">
                <img src="../images/company-svgrepo-com.svg" alt="">
                <a>Empresas</a>
            </li>
            <li onclick="window.location.href='../Propriedades/propriedades.html'">
                <img src="../images/brazil-svgrepo-com.svg" alt="">
                <a>Propriedades</a>
            </li>
        </ul>
    </div>




    <section id='empresas'>

        <div class="adicionar_empresas" id="add_empresa" style="display: none;">
            <h1>Cadastrar Empresa</h1>
            <div class="inputs_cadastrar_empresa">
                <div>
                    <label for="input_add_cnpj">CNPJ</label>
                    <input type="text" id="input_add_cnpj" placeholder="00.000.000/0000-00.">
                </div>
                <div>
                    <label for="input_add_razaoSocial">Razão Social</label>
                    <input type="text" id="input_add_razaoSocial" placeholder="Insira a Razão Social.">
                </div>
                <div>
                    <label for="input_add_nomeFantasia">Nome Fantasia</label>
                    <input type="text" id="input_add_nomeFantasia" placeholder="Insira o Nome Fantasia.">
                </div>
                <div>
                    <label for="input_add_ie">Inscrição Estadual</label>
                    <input type="text" id="input_add_ie" placeholder="Insira a Inscrição Estadual." >
                </div>
                <div>
                    <label for="input_add_cidade">Cidade</label>
                    <input type="text" id="input_add_cidade" placeholder="Insira a Cidade.">
                </div>

                <div>
                    <label for="input_add_cep">CEP</label>
                    <input type="text" id="input_add_cep" placeholder="Insira o CEP (00000-000)." >
                </div>
                <div>
                    <label for="input_add_uf">Unidade Federativa (UF)</label>
                    <input list="suggestions" type="text" id="input_add_uf" placeholder="Insira a Unidade Federativa (Estado)." maxlength="2">
                    <datalist id="suggestions">
                        <option value="AC">
                        <option value="AL">
                        <option value="AP">
                        <option value="AM">
                        <option value="BA">
                        <option value="CE">
                        <option value="DF">
                        <option value="ES">
                        <option value="GO">
                        <option value="MA">
                        <option value="MT">
                        <option value="MS">
                        <option value="MG">
                        <option value="PA">
                        <option value="PB">
                        <option value="PR">
                        <option value="PE">
                        <option value="PI">
                        <option value="RJ">
                        <option value="RN">
                        <option value="RS">
                        <option value="RO">
                        <option value="RR">
                        <option value="SC">
                        <option value="SP">
                        <option value="SE">
                        <option value="TO">
                    </datalist>
                </div>
                <div>
                    <label for="input_add_numero">Número</label>
                    <input type="number" id="input_add_numero" placeholder="Insira o Número.">
                </div>
                <div>
                    <label for="input_add_bairro">Bairro</label>
                    <input type="text" id="input_add_bairro" placeholder="Insira o Bairro.">
                </div>
                <div>
                    <label for="input_add_logradouro">Logradouro</label>
                    <input type="text" id="input_add_logradouro" placeholder="Insira o Logradouro.">
                </div>
                <div>
                    <label for="input_add_complemento">Complemento</label>
                    <input type="text" id="input_add_complemento" placeholder="Insira o complemento.">
                </div>

            </div>
            <div>
                <button class="drawer_button" id="cadastrarBtn">Cadastrar</button>
                <button class="drawer_button_sec" onclick="toggleDrawerCadastro()">Fechar</button>
            </div>

        </div>
        <nav class="navbar">
            <div class="nav-profile" onclick="toggleMenuSuspenso()">
                <div class="user-profile-button" id="user_profile-image">
                    <i class="fa-solid fa-user icon-modify"></i>

                </div>

                <div class="sub-menu-wrap" id="subMenu">
                    <div class="sub-menu">
                        <div class="user-info">
                            <i class="fa-solid fa-user icon-modify"></i>
                            <h2 class="user-name" id="username">Usuário</h2>
                        </div>

                        <a href="../Conta/conta.html" class="submenu-option">
                            <i class="fa-solid fa-gear icon-modify"></i>
                            <p>Conta</p>
                            <span> > </span>
                        </a>

                        <a href="../index.html" onclick="limparSessao()" class="submenu-option">
                            <i class="fa-solid fa-door-open icon-modify"></i>
                            <p>Sair</p>
                            <span> > </span>
                        </a>



                    </div>
                </div>


        </nav>
        <div id="listagem_empresas" style="display: flex;">
            <div class="container_listagem">
                <div class="list_actions">
                    <h1 id="addRow">Listagem das Empresas</h1>
                    <button class="list_button" onclick="toggleDrawerCadastro()">Cadastrar Empresa</button>
                </div>
                <section class="campos">
                    <table id="tabela_empresas" class="display" width="70vw" max-height="200px">
                        <thead>
                            <tr>
                                <th>Nome Fantasia</th>
                                <th>Cidade</th>
                                <th>CEP</th>
                                <th>CNPJ</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                    </table>
                </section>

            </div>
        </div>

        <div id="edit_empresa" style="display: none;">
            <h1>Editar Empresa</h1>
            <div class="inputs_cadastrar_empresa">
                <div class="div_checkbox-status">
                    <input type="checkbox" name="" id="ckbox_status_empresa">
                    <label for="ckbox_status_empresa">Ativar Empresa</label>
                </div>
                <div>
                    <label for="input_edit_cnpj">CNPJ</label>
                    <input type="text" id="input_edit_cnpj" placeholder="00.000.000/0000-00." disabled>
                </div>
                <div>
                    <label for="input_edit_razaoSocial">Razão Social</label>
                    <input type="text" id="input_edit_razaoSocial" placeholder="Insira a Razão Social.">
                </div>
                <div>
                    <label for="input_edit_nomeFantasia">Nome Fantasia</label>
                    <input type="text" id="input_edit_nomeFantasia" placeholder="Insira o Nome Fantasia.">
                </div>
                <div>
                    <label for="input_edit_ie">Inscrição Estadual</label>
                    <input type="text" id="input_edit_ie" placeholder="Insira a Inscrição Estadual." disabled>
                </div>
                <div>
                    <label for="input_edit_cidade">Cidade</label>
                    <input type="text" id="input_edit_cidade" placeholder="Insira a Cidade.">
                </div>

                <div>
                    <label for="input_edit_cep">CEP</label>
                    <input type="text" id="input_edit_cep" placeholder="Insira o CEP (00000-000).">
                </div>
                <div>
                    <label for="input_edit_uf">Unidade Federativa (UF)</label>
                    <input list="suggestions" type="text" id="input_edit_uf" placeholder="Insira a Unidade Federativa (Estado)." maxlength="2">
                    <datalist id="suggestions">
                        <option value="AC">
                        <option value="AL">
                        <option value="AP">
                        <option value="AM">
                        <option value="BA">
                        <option value="CE">
                        <option value="DF">
                        <option value="ES">
                        <option value="GO">
                        <option value="MA">
                        <option value="MT">
                        <option value="MS">
                        <option value="MG">
                        <option value="PA">
                        <option value="PB">
                        <option value="PR">
                        <option value="PE">
                        <option value="PI">
                        <option value="RJ">
                        <option value="RN">
                        <option value="RS">
                        <option value="RO">
                        <option value="RR">
                        <option value="SC">
                        <option value="SP">
                        <option value="SE">
                        <option value="TO">
                    </datalist>
                </div>
                <div>
                    <label for="input_edit_numero">Número</label>
                    <input type="text" id="input_edit_numero" placeholder="Insira o Número.">
                </div>
                <div>
                    <label for="input_edit_bairro">Bairro</label>
                    <input type="text" id="input_edit_bairro" placeholder="Insira o Bairro.">
                </div>
                <div>
                    <label for="input_edit_logradouro">Logradouro</label>
                    <input type="text" id="input_edit_logradouro" placeholder="Insira o Logradouro.">
                </div>
                <div>
                    <label for="input_edit_complemento">Complemento</label>
                    <input type="text" id="input_edit_complemento" placeholder="Insira o complemento.">
                </div>

            </div>
            <div>
                <button class="drawer_button" id="editarBtn">Editar</button>
                <button class="drawer_button_sec" id="" onclick="toggleDrawerEdit()">Fechar</button>
            </div>

        </div>
    </section>

</body>

</html>


<script>
    console.log(window.location.href == "http://localhost:3333/Empresas/empresas.html")
    let counter = 1;

    function adicionarNovaEmpresaTabela() {
        const table = $('#tabela_empresas').DataTable();
        table.row
            .add([
                localStorage.nomeFantasia,
                localStorage.cidade,
                localStorage.cep,
                localStorage.cnpj,
                localStorage.status,
                `<button onclick="toggleDrawerEdit(this)" class="edit_btn">Editar</button>`
            ])
            .draw(false);

        counter++;
    }

    $(document).ready(function () {
        $('#tabela_empresas').DataTable({
            language: {
                lengthMenu: "Mostrar _MENU_ empresas por página",
                zeroRecords: "Nenhuma empresa encontrada",
                info: "Mostrando _START_ até _END_ de _TOTAL_ empresas",
                infoEmpty: "Mostrando 0 até 0 de 0 empresas",
                infoFiltered: "(filtrado de _MAX_ empresas no total)",
                search: "Buscar:",
                paginate: {
                    first: "Primeiro",
                    last: "Último",
                    next: "Próximo",
                    previous: "Anterior"
                }
            },
        });

        document.querySelector('#addRow').addEventListener('click', adicionarNovaEmpresaTabela);
    });

    function toggleDrawerEdit(button) {

        alert("Editar empresa: " + button.closest('tr').cells[0].textContent);
    }

</script>

<script>

    function toggleDrawerCadastro() {
        const div = document.getElementById("add_empresa");
        if (div.style.display === "none") {
            div.style.display = "flex";
        } else {
            div.style.display = "none";
        }
    }

    function toggleDrawerEdit() {
        const divEdit = document.getElementById("edit_empresa");
        if (divEdit.style.display === "none") {
            divEdit.style.display = "flex";
        } else {
            divEdit.style.display = "none";
        }
    }


    function toggleMenu() {
        const menu = document.getElementById("menu");
        menu.classList.toggle("show-menu");
    }




    function apareceInfos(id) {
        document.getElementById(id).style.display = "flex";
        document.getElementById(id).style.opacity = 1;
    }

    function someInfos(id) {
        document.getElementById(id).style.display = "none";
        document.getElementById(id).style.opacity = 0;
    }
</script>


<script type="module">
    import { cadastrarEmpresa } from '../empresaFetch.js';
    import { buscarEmpresas } from '../empresaFetch.js';

    buscarEmpresas()
    console.log("id usuario ->", sessionStorage.ID_USUARIO)
    console.log("nome usuario ->", sessionStorage.NOME_USUARIO)
    document.getElementById('cadastrarBtn').addEventListener('click', cadastrarEmpresa);
</script>

<script>
    let subMenu = document.getElementById("subMenu");

    function toggleMenuSuspenso() {
        subMenu.classList.toggle("open-menu");
    };

    
</script>


<script>

    $(document).ready(function () {
        $('#input_edit_cep').mask('00000-000');
        $('#input_add_cep').mask('00000-000');
        $('#input_add_ie').mask('00.000.0000-0');
        $('#input_add_cnpj').mask('00.000.000/0000-00')
    });

</script>