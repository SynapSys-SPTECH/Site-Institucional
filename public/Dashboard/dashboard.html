<!DOCTYPE html>
<html lang="pt-br">



<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/Icon-SynapSysBranco.svg" type="image/x-icon" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="../Componentes/MenuLateral/MenuLateral.css">
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <script src="Mapas/geojs-29-mun.json"></script>


    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.pm@2.10.2/dist/leaflet.pm.css" />


    <!-- Config menu suspenso -->
    <link rel="stylesheet" href="../Componentes/MenuSuspenso/submenu.css">
    <script src="https://kit.fontawesome.com/80ec270284.js" crossorigin="anonymous"></script>

    <!-- Validação de Sessão -->
    <script src="../Javascript/sessao.js"></script>
    <script src="../crudPropriedade.js"></script>

    <!-- Sweet Alerts 2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <title>Dashboard</title>
    <!-- <script src="../fetchs.js"></script> -->

</head>

<script>
    window.onload = function () {
        validarSessao(),
            verificarPossuiEmpresa()
    }


</script>

<body>
    <!-- INICIO Navbar -->
    <!-- <script src="../Componentes/MenuLateral/MenuLateral.js"></script> -->

    <div class="menu_lateral">
        <h3>Empresa</h3>

        <ul>
            <li onclick="window.location.href='../Dashboard/dashboard.html'" id="tela_ativa">
                <img src="../images/chart-svgrepo-com.svg" alt="">
                <a>Dashboard</a>
            </li>
            <li onclick="window.location.href='../Empresas/empresas.html'">
                <img src="../images/company-svgrepo-com.svg" alt="">
                <a>Empresas</a>
            </li>
            <li onclick="window.location.href='../Propriedades/propriedades.html'">
                <img src="../images/brazil-svgrepo-com.svg" alt="">
                <a>Propriedades</a>
            </li>
        </ul>
    </div>

    <!-- FIM Navbar -->
    <div class='container'>
        <section id='dashboard'>
            <nav class="navbar">
                <div>
                    <div class="textNavbar">
                        <label for="id_propriedade">Escolha a Empresa:</label>
                    </div>

                    <select class="selectNavbar" name="Propriedade" id="select_empresa">Escolha a Empresas

                    </select>
                </div>


                <div class="nav-profile" onclick="toggleMenuSuspenso()">
                    <div class="user-profile-button" id="user_profile-image">
                        <i class="fa-solid fa-user icon-modify"></i>

                    </div>

                    <div class="sub-menu-wrap" id="subMenu">
                        <div class="sub-menu">
                            <div class="user-info">
                                <i class="fa-solid fa-user icon-modify"></i>
                                <h2 class="user-name" id="username">Usuário</h2>
                            </div>

                            <a href="../Conta/conta.html" class="submenu-option">
                                <i class="fa-solid fa-gear icon-modify"></i>
                                <p>Conta</p>
                                <span> > </span>
                            </a>

                            <a href="../index.html" onclick="limparSessao()" class="submenu-option">
                                <i class="fa-solid fa-door-open icon-modify"></i>
                                <p>Sair</p>
                                <span> > </span>
                            </a>



                        </div>
                    </div>


            </nav>

            <div class="main-dashboard">
                <div class="kpis">
                    <div class="kpi">
                        <h1>Pontos com Potencial de Expansão</h1>
                        <span id="qtdPontosPotencialExpansao"></span>
                    </div>
                    <div class="kpi">
                        <h1>Dias com Ventos Acima dos Limites</h1>
                        <span id="diasVentosAcimaDoLimite"></span>
                    </div>
                </div>
                <div class="graficos">
                    <div class="grafico">
                        <div id="myChart" style="width: 30vw; height:40vh"></div>
                    </div>
                    <div class="grafico">

                        <div id="map"></div>
                    </div>
                </div>

            </div>

        </section>
    </div>








    <!-- ALERTS PARA A PÁGINA -->

    <!-- Alert caso não possua empresa. -->
    <script src="../Componentes/Alerts/possuiEmpresa.js"></script>






</body>

<script src="../fetchs.js">
    let idUsuario = sessionStorage.getItem("ID_USUARIO")
</script>


</html>



<script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart(dados) {


        const data = google.visualization.arrayToDataTable([
            ['Data', 'Mhl'],
            [dados[0], dados[1]],
            [dados[2], dados[3]],
            [dados[4], dados[5]],
            [dados[6], dados[7]],
            [dados[8], dados[9]]
        ]);


        const options = {
            title: 'MESES COM MAIS QUANTIDADE DE CAPTURAS FAVORAVEIS',
            titleTextStyle: {
                fontSize: 14 // tamanho da fonte do título
            },
            hAxis: { title: 'Velocidade' },
            vAxis: { title: 'Meses' },
            legend: 'none',
            colors: ['#1b9e77', '#d95f02'],
            size: '60px'
        };


        const chart = new google.visualization.BarChart(document.getElementById('myChart'));
        chart.draw(data, options);

    }
</script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.pm@2.10.2/dist/leaflet.pm.min.js"></script>

<script>

    var bounds = [
        [-9.583, -50.109],
        [-17.766, -34.196]
    ];


    var map = L.map('map', {
        maxBounds: bounds,
        minZoom: 5.4,
        maxZoom: 8
    }).fitBounds(bounds);


    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    let latitude = parseFloat(sessionStorage.getItem("latitudeEmpresa"));
    let longitude = parseFloat(sessionStorage.getItem("longitudeEmpresa"));
    
    var marker = L.marker([latitude, longitude]).addTo(map);

    var theTrail = L.geoJSON(trail, {
        color: '#999999999',
        weight: 3,
        dashArray: '12 8 12',
    });
    theTrail.addTo(map);

    
    function getCountByColor(color) {
        if (color === 'red') {
            return randomNumber(2000, 3000);
        } else if (color === 'orange') {
            return randomNumber(1000, 1999);
        } else if (color === 'yellow') {
            return randomNumber(100, 999);
        } else {
            return randomNumber(0, 99);
        }
    }

    // Função para gerar números aleatórios dentro de um intervalo específico
    function randomNumber(min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
    }

    window.myMap = map;
</script>


<script>
    let subMenu = document.getElementById("subMenu");

    function toggleMenuSuspenso() {
        subMenu.classList.toggle("open-menu");
    };

    var usernameValue = sessionStorage.NOME_USUARIO;
    document.getElementById('username').textContent = usernameValue;
</script>

<script type="module">
    import { cadastrar } from '../crudPropriedade.js';
    import { buscarPropriedade } from '../crudPropriedade.js';
    import { buscarEmpresaPorCidade } from './fetchDashboard.js';
    import { buscarPontosComPotencialDeExpansao } from "./fetchDashboard.js";
    import { quantidadePontosDeExpansao } from "./fetchDashboard.js";
    import { diasComVentosAcimaDoLimite } from "./fetchDashboard.js";

    buscarPropriedade()
    document.getElementById('cadastrarBtn').addEventListener('click', cadastrar);
    buscarPontosComPotencialDeExpansao(); 
    diasComVentosAcimaDoLimite();
    
    document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('select_empresa').addEventListener('change', ()=> {
    sessionStorage.setItem("valorSelectEmpresaDashboard", select_empresa.value)
    buscarEmpresaPorCidade(sessionStorage.valorSelectEmpresaDashboard).then(() => {
                atualizarMapa();
            });
  });
});
</script>

<script type="module">
    import { buscarLongitudeLatitude } from './fetchDashboard.js';
    buscarLongitudeLatitude()
</script>

