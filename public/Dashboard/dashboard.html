<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="../Componentes/MenuLateral/MenuLateral.css">

    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.pm@2.10.2/dist/leaflet.pm.css" />

    <title>Dashboard</title>
    <!-- <script src="../fetchs.js"></script> -->

</head>

<body>
    <!-- INICIO Navbar -->
    <script src="../Componentes/MenuLateral/MenuLateral.js"></script>
    <!-- FIM Navbar -->
    <div class='container'>
        <section id='dashboard'>
            <nav class="navbar">
                <p>navbar</p>
            </nav>
            <div class="main-dashboard">
                <div class="kpis">
                    <div class="kpi">
                        <h1>Constância dos Ventos(%)</h1>
                        <span>10</span>
                    </div>
                    <div class="kpi">
                        <h1>Cidades com Potencial</h1>
                        <span>10</span>
                    </div>
                    <div class="kpi">
                        <h1>Dias com Ventos Acima dos Limites (%)</h1>
                        <span>10</span>
                    </div>
                </div>
                <div class="graficos">
                    <div class="grafico">
                        <div id="myChart" style="max-width:400px; height:400px"></div>
                    </div>
                    <div class="grafico">
                        <h1>Mapa</h1>
                        <div id="map"></div>
                    </div>
                </div>

            </div>

        </section>
    </div>

</body>

<script src="../fetchs.js">
    let idUsuario = sessionStorage.getItem("ID_USUARIO")
</script>


</html>

<script type="module">
    import { cadastrarEmpresa } from '../empresaFetch.js';

    document.getElementById('cadastrarBtn').addEventListener('click', cadastrarEmpresa);
</script>

<script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {


        const data = google.visualization.arrayToDataTable([
            ['Contry', 'Mhl'],
            ['Italy', 55],
            ['France', 49],
            ['Spain', 44],
            ['USA', 24],
            ['Argentina', 15]
        ]);


        const options = {
            title: 'TOP 3 HARDCORE VENTOS DO NORDESTE',
            hAxis: { title: 'Square Meters' },
            vAxis: { title: 'Price in Millions' },
            legend: 'none',
            colors: ['#1b9e77', '#d95f02']
        };


        const chart = new google.visualization.ColumnChart(document.getElementById('myChart'));
        chart.draw(data, options);

    }
</script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.pm@2.10.2/dist/leaflet.pm.min.js"></script>

<script>
    // Inicializando o mapa centralizado no Nordeste
    const map = L.map('map').setView([-9.649849, -36.612738], 6);

    const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // Control para mostrar info dos estados ao passar o mouse
    const info = L.control();

    info.onAdd = function (map) {
        this._div = L.DomUtil.create('div', 'info');
        this.update();
        return this._div;
    };

    info.update = function (props) {
        const contents = props ? `<b>${props.name}</b><br />${props.density} hab/km<sup>2</sup>` : 'Passe o mouse sobre um estado';
        this._div.innerHTML = `<h4>Densidade Populacional</h4>${contents}`;
    };

    info.addTo(map);

    // Função para obter a cor baseada na densidade populacional
    function getColor(d) {
        return d > 100 ? '#800026' :
               d > 50  ? '#BD0026' :
               d > 20  ? '#E31A1C' :
               d > 10  ? '#FC4E2A' :
               d > 5   ? '#FD8D3C' :
               d > 2   ? '#FEB24C' :
               d > 1   ? '#FED976' : '#FFEDA0';
    }

    function style(feature) {
        return {
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7,
            fillColor: getColor(feature.properties.density)
        };
    }

    function highlightFeature(e) {
        const layer = e.target;

        layer.setStyle({
            weight: 5,
            color: '#666',
            dashArray: '',
            fillOpacity: 0.7
        });

        layer.bringToFront();

        info.update(layer.feature.properties);
    }

    function resetHighlight(e) {
        geojson.resetStyle(e.target);
        info.update();
    }

    function zoomToFeature(e) {
        map.fitBounds(e.target.getBounds());
    }

    function onEachFeature(feature, layer) {
        layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight,
            click: zoomToFeature
        });
    }

    // GeoJSON com os estados do Nordeste e suas propriedades
    const geojson = L.geoJson(nordesteData, {
        style,
        onEachFeature
    }).addTo(map);

    // Legenda
    const legend = L.control({position: 'bottomright'});

    legend.onAdd = function (map) {
        const div = L.DomUtil.create('div', 'info legend');
        const grades = [0, 1, 2, 5, 10, 20, 50, 100];
        const labels = [];
        let from, to;

        for (let i = 0; i < grades.length; i++) {
            from = grades[i];
            to = grades[i + 1];

            labels.push(`<i style="background:${getColor(from + 1)}"></i> ${from}${to ? `&ndash;${to}` : '+'}`);
        }

        div.innerHTML = labels.join('<br>');
        return div;
    };

    legend.addTo(map);
</script>